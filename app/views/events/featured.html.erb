<div class="container">
<section>
    <article id="featured-carousel" class="row">
        <div class="span8">
            <figure>
                <div id="featured-events" class="carousel slide img-polaroid"><!-- class of slide for animation -->
                    <div class="carousel-inner">
                        <% @events.each_with_index do |event, i| %>
                        <div class="item <%= "active" if i == 0 %>">
                            <%= image_tag event.photo_featured.url(:featured), :style => "height: 350px" %>
                            <div class="carousel-caption">
                                <h2><%= event.name %></h2>
                            </div>
                        </div>
                        <% end %>
                    </div> <!-- /.carousel-inner -->

                    <a class="carousel-control left" href="#featured-events" data-slide="prev">&lsaquo;</a>
                    <a class="carousel-control right" href="#featured-events" data-slide="next">&rsaquo;</a>
                </div> <!-- /.carousel -->
                    
                <figcaption class="featured_badges">
                    <% @events.each_with_index do |event, i| %>
                        <div class="item <%= "hide" if i != 0 %>" id="carousel-badges-<%=i %>">
                                <%= render :partial => "skills/strip", :locals => { :entity => event, :size => "small" } %>
                        </div>
                    <% end %>
                </figcaption><!-- Badges under the main carousel -->
            </figure><!-- /.featured-carousel-->
        </div><!-- /.span8-->
        <div class="span4">
            <% @events.each_with_index do |event, i| %>
            <div class="item <%= "hide" if i != 0 %>" id="carousel-<%=i %>">
                <a href="<%= register_event_url(event) %>" data-method="post" rel="nofollow" class="btn btn-large btn-warning">
                    <h2>Join Us!</h2>
                    <div class="countdown">
                        <div class="countdownTitle">Countdown</div>
                        <p id="countdownTime-<%= i %>">&nbsp;</p>
                    </div>
                    <script type="text/javascript">
                        $(window).load(function() {
                            setInterval(function() {
                                $("#countdownTime-<%= i %>").text(countdownString(new Date(<%= @events[i].start.strftime("%Y, %m, %d, %H, 0, 0, 0") %>)));
                            }, 100);
                        })
                    </script>
                </a>
                <div class="address"><%= link_to event.geocode_address, "https://maps.google.com/?q=#{event.geocode_address}" %></div>
                <p class="featured"><%= event.description %></p>
                    <div class="sponsor">
                        <h3>Sponsor<span class="arrow-left"></span><span class="arrow-right"></span></h3>
                        <a href="http://www.cupcakeroyale.com/">
                            <img src= "/assets/sponsors/cupcake_royale.png" alt="Cupcake Royale" height="50" width="50" />
                        </a>
                        <p>Cupcake Royale was founded in 2003 as Seattle's first cupcake bakery and caf√©. In fact, Cupcake Royale is the nations first cupcake bakery to open outside of NYC! So you can imagine that many of our friends and neighbors didn't know quite what to expect.</p>
                    </div><!-- /.sponsor -->          
            </div><!-- /.item -->
            <% end %>
            <script type="text/javascript">
                $(function() {
                    $('body').on('slide', function (e) {
                        var prevIndex = $('#featured-events .active').index('#featured-events .item');
                        var nextIndex = $(e.relatedTarget).index('#featured-events .item');
                        $("#carousel-" + prevIndex).hide();
                        $("#carousel-badges-" + prevIndex).hide();
                        $("#carousel-" + nextIndex).show();
                        $("#carousel-badges-" + nextIndex).show();
                    });
                });
            </script>
        </div><!-- /.span4-->
    </article><!-- /#featued-carousel .class-->
</section>
<section>
    <% @events.each_with_index do |event, i| %>
    <% if i % 3 == 0 %>
    <ul class="thumbnails">
    <% end %>    
        <article>
            <li class="span4 unstyled">
                <figure>
                    <%= link_to event_url(event) do %>
                        <%= image_tag event.photo_featured.url(:large), :class => "img-polaroid pic", :style => "height: 200px; width: 290px" %>
                    <% end %>
                    <figcaption class = "clearfix"><%= render :partial => "skills/strip", :locals => { :entity => event, :size => "small" } %></figcaption>
                </figure>
                <h2><%= event.name %></h2>
                <div class="address"><%= link_to event.geocode_address, "https://maps.google.com/?q=#{event.geocode_address}" %></div>
                <p><%= event.description %></p>
                <p><%= link_to "View Details", event_url(event), :class => "btn" %></p>
            </li>
        </article>
    <% if ((i+1) % 3) == 0 || @events.count == i %>
    </ul>
    <% end %>
    <% end %>
</section>
</div><!-- /.container -->
